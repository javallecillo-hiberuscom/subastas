<div class="empresas-admin-container">
  <div class="header">
    <h1>Gesti√≥n de Empresas</h1>
    <div class="header-actions">
      <input 
        type="text" 
        class="search-input"
        placeholder="Buscar por nombre, CIF, email o tel√©fono..."
        [value]="busqueda()"
        (input)="busqueda.set($any($event.target).value)"
      />
      <button class="btn-primary" (click)="mostrarFormulario()">
        <span>+</span>
        <span>Nueva Empresa</span>
      </button>
    </div>
  </div>

  @if (successMessage()) {
    <div class="alert alert-success">
      <span>‚úì</span>
      <span>{{ successMessage() }}</span>
    </div>
  }

  @if (errorMessage()) {
    <div class="alert alert-error">
      <span>‚ö†Ô∏è</span>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  @if (showForm()) {
    <div class="form-overlay" (click)="cancelar()">
      <div class="form-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ editingId ? 'Editar Empresa' : 'Nueva Empresa' }}</h2>
          <button class="btn-close" (click)="cancelar()">√ó</button>
        </div>

        <form [formGroup]="empresaForm" (ngSubmit)="guardar()">
          <div class="form-grid">
            <div class="form-group">
              <label>CIF *</label>
              <input 
                type="text" 
                formControlName="cif" 
                placeholder="A12345678"
                [class.invalid]="empresaForm.get('cif')?.invalid && empresaForm.get('cif')?.touched"
              >
              @if (empresaForm.get('cif')?.invalid && empresaForm.get('cif')?.touched) {
                <span class="error-text">CIF inv√°lido (formato: A12345678)</span>
              }
            </div>

            <div class="form-group">
              <label>Nombre *</label>
              <input 
                type="text" 
                formControlName="nombre" 
                placeholder="Nombre de la empresa"
                [class.invalid]="empresaForm.get('nombre')?.invalid && empresaForm.get('nombre')?.touched"
              >
            </div>

            <div class="form-group full-width">
              <label>Direcci√≥n *</label>
              <input 
                type="text" 
                formControlName="direccion" 
                placeholder="Direcci√≥n completa"
                [class.invalid]="empresaForm.get('direccion')?.invalid && empresaForm.get('direccion')?.touched"
              >
            </div>

            <div class="form-group">
              <label>Tel√©fono</label>
              <input 
                type="text" 
                formControlName="telefono" 
                placeholder="123456789"
                [class.invalid]="empresaForm.get('telefono')?.invalid && empresaForm.get('telefono')?.touched"
              >
            </div>

            <div class="form-group">
              <label>Email</label>
              <input 
                type="email" 
                formControlName="email" 
                placeholder="empresa@ejemplo.com"
                [class.invalid]="empresaForm.get('email')?.invalid && empresaForm.get('email')?.touched"
              >
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="activo">
                <span>Activo</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
            <button type="submit" class="btn-primary" [disabled]="empresaForm.invalid">
              {{ editingId ? 'Actualizar' : 'Crear' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando empresas...</p>
    </div>
  } @else if (empresas().length === 0) {
    <div class="empty-state">
      <span class="empty-icon">üè¢</span>
      <h3>No hay empresas registradas</h3>
      <p>Comienza agregando una nueva empresa</p>
    </div>
  } @else {
    <div class="table-container">
      <table class="empresas-table">
        <thead>
          <tr>
            <th>CIF</th>
            <th>Nombre</th>
            <th>Direcci√≥n</th>
            <th>Tel√©fono</th>
            <th>Email</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (empresa of empresasFiltradas(); track empresa.idEmpresa) {
            <tr>
              <td>{{ empresa.cif }}</td>
              <td>{{ empresa.nombre }}</td>
              <td>{{ empresa.direccion }}</td>
              <td>{{ empresa.telefono || '-' }}</td>
              <td>{{ empresa.email || '-' }}</td>
              <td>
                <span 
                  class="badge"
                  [class.badge-activo]="empresa.activo"
                  [class.badge-inactivo]="!empresa.activo"
                  (click)="toggleActivo(empresa)"
                  style="cursor: pointer;"
                >
                  {{ empresa.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td>
                <div class="actions">
                  <button class="btn-icon btn-edit" (click)="editarEmpresa(empresa)" title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <button class="btn-icon btn-delete" (click)="eliminar(empresa.idEmpresa)" title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
