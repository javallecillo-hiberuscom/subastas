# Script para configurar variables de entorno en Azure App Service
# Reemplaza <nombre-app-service> con el nombre real de tu App Service

$appName = "SubastasWebApi20260202162157"  # Cambia esto por tu nombre real
$resourceGroup = "tu-resource-group"  # Cambia esto

Write-Host "Configurando variables de entorno para $appName..." -ForegroundColor Green

# Configurar Connection String
az webapp config connection-string set `
    --name $appName `
    --resource-group $resourceGroup `
    --settings SubastaConnection="Server=tcp:fpcursos.database.windows.net,1433;Initial Catalog=subasta;Persist Security Info=False;User ID=adminoc;Password=A0a0f0f011;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" `
    --connection-string-type SQLAzure

# Configurar JWT Settings
az webapp config appsettings set `
    --name $appName `
    --resource-group $resourceGroup `
    --settings `
        JwtSettings__SecretKey="TU_CLAVE_SECRETA_SUPER_SEGURA_DE_AL_MENOS_32_CARACTERES" `
     JwtSettings__Issuer="SubastasAPI" `
 JwtSettings__Audience="SubastasClient" `
        JwtSettings__ExpirationMinutes="60"

# Configurar Email Settings (opcional - actualiza con tus credenciales reales)
az webapp config appsettings set `
    --name $appName `
    --resource-group $resourceGroup `
    --settings `
        Email__SmtpHost="smtp.gmail.com" `
        Email__SmtpPort="587" `
        Email__SmtpUser="tu-email@gmail.com" `
   Email__SmtpPass="tu-contraseña-de-aplicacion" `
        Email__FromName="Sistema de Subastas - Desguaces Borox" `
        Email__AdminEmail="admin@desguacesborox.com"

# Configurar CORS Origins permitidos (agrega tu dominio de producción)
az webapp config appsettings set `
    --name $appName `
--resource-group $resourceGroup `
    --settings `
        AllowedOrigins__0="https://tu-frontend.azurewebsites.net" `
        AllowedOrigins__1="http://localhost:4200"

# Habilitar logging detallado
az webapp log config `
    --name $appName `
    --resource-group $resourceGroup `
    --application-logging filesystem `
    --detailed-error-messages true `
    --failed-request-tracing true `
    --web-server-logging filesystem

Write-Host "Configuración completada!" -ForegroundColor Green
Write-Host "Para ver los logs, ejecuta:" -ForegroundColor Yellow
Write-Host "az webapp log tail --name $appName --resource-group $resourceGroup" -ForegroundColor Cyan
